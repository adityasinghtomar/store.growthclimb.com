"use strict";if(void 0===woostifyEvent)var woostifyEvent={};var frame,woostifyData=woostify_variation_swatches_admin||{};function init_gallery_sortable(t){var a=($=jQuery)(t);if(a.length){var i=[];(i=a.hasClass("product_variation_images")?a:a.find("ul.product_variation_images")).sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"image wc-metabox-sortable-placeholder product_image_variation_placeholder",start:function(t,a){a.item.css("background-color","#f6f6f6")},stop:function(t,a){a.item.removeAttr("style")},update:function(t,a){var i=[],e=a.item.closest(".row-product_variation_images");e.find("ul li.image").css("cursor","default").each(function(){var t=$(this).attr("data-attachment_id");i.push(t)}),e.find("input.product_image_variation_gallery").val(i.join(",")).trigger("change")}})}}function init_product_variation_image_gallery(t){var a=($=jQuery)(t);init_gallery_sortable(a),a.on("click","a.add-product-variation-gallery",function(t){t.preventDefault();var a,i=$(this),e=i.closest(".row-product_variation_images"),o=e.find(".product_image_variation_gallery"),s=e.find("ul.product_variation_images");a?a.open():a=wp.media.frames.product_variation_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0}),]}),a.off("select").on("select",function(){var t=a.state().get("selection"),r=o.val();t.map(function(t){if((t=t.toJSON()).id){r=r?r+","+t.id:t.id;var a=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;s.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+a+'" /><ul class="actions"><li><a href="javascript:void(0);" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),o.val(r).trigger("change"),init_gallery_sortable(e)}),a.open()}),a.on("click",".product_variation_images a.delete",function(t){var a=$(this).closest(".row-product_variation_images");$(this).closest("li.image").remove();var i=[];return a.find("ul li.image").css("cursor","default").each(function(){var t=$(this).attr("data-attachment_id");i.push(t)}),a.find(".product_image_variation_gallery").val(i.join(",")).trigger("change"),!1})}document.addEventListener("DOMContentLoaded",function(){if(!woostifyEvent.adminVariationGallery){var t=window.wp,a=jQuery("body");jQuery("#term-color").wpColorPicker(),a.on("click",".woostify-variation-swatches-upload-image-button",function(a){a.preventDefault();var i=jQuery(this);if(frame){frame.open();return}(frame=t.media.frames.downloadable_file=t.media({title:woostifyData.i18n.mediaTitle,button:{text:woostifyData.i18n.mediaButton},multiple:!1})).on("select",function(){var t=frame.state().get("selection").first().toJSON();i.siblings("input.woostify-variation-swatches-term-image").val(t.id),i.siblings(".woostify-variation-swatches-remove-image-button").show(),i.parent().prev(".woostify-variation-swatches-term-image-thumbnail").find("img").attr("src",t.sizes.thumbnail.url)}),frame.open()}).on("click",".woostify-variation-swatches-remove-image-button",function(){var t=jQuery(this);return t.siblings("input.woostify-variation-swatches-term-image").val(""),t.siblings(".woostify-variation-swatches-remove-image-button").show(),t.parent().prev(".woostify-variation-swatches-term-image-thumbnail").find("img").attr("src",woostifyData.placeholder),!1});var i=jQuery("#woostify-variation-swatches-modal-container"),e=i.find(".spinner"),o=i.find(".message"),s=null;a.on("click",".variation_swatches_add_new_attribute",function(a){a.preventDefault();var e=jQuery(this),o=t.template("woostify-variation-swatches-input-tax"),r={type:e.data("type"),tax:e.closest(".woocommerce_attribute").data("taxonomy")};i.find(".woostify-variation-swatches-term-swatch").html(jQuery("#tmpl-woostify-variation-swatches-input-"+r.type).html()),i.find(".woostify-variation-swatches-term-tax").html(o(r)),"color"==r.type&&i.find("input.woostify-variation-swatches-input-color").wpColorPicker(),s=e.closest(".woocommerce_attribute.wc-metabox"),i.show()}).on("click",".woostify-variation-swatches-modal-close, .woostify-variation-swatches-modal-backdrop",function(t){t.preventDefault(),r()}),a.on("click",".woostify-variation-swatches-new-attribute-submit",function(a){a.preventDefault();var n=(jQuery(this).data("type"),!1),l={};i.find(".woostify-variation-swatches-input").each(function(){var t=jQuery(this);"slug"==t.attr("name")||t.val()?t.removeClass("error"):(t.addClass("error"),n=!0),l[t.attr("name")]=t.val()}),!n&&(e.addClass("is-active"),o.hide(),t.ajax.send("variation_swatches_add_new_attribute",{data:l,error:function(t){e.removeClass("is-active"),o.addClass("error").text(t).show()},success:function(t){e.removeClass("is-active"),o.addClass("success").text(t.msg).show(),s.find("select.attribute_values").append('<option value="'+t.id+'" selected="selected">'+t.name+"</option>"),s.find("select.attribute_values").change(),r()}}))}),init_product_variation_image_gallery("#variable_product_options"),woostifyEvent.adminVariationGallery=1}function r(){i.find(".woostify-variation-swatches-term-name input, .woostify-variation-swatches-term-slug input").val(""),e.removeClass("is-active"),o.removeClass("error success").hide(),i.hide()}});